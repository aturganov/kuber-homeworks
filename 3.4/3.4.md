# Домашнее задание к занятию "Обновление приложений"

### Цель задания

Выбрать и настроить стратегию обновления приложения.

### Чеклист готовности к домашнему заданию

1. Кластер k8s.
```
locadm@netology01:~/git/kuber-homeworks$ yc compute instance list
+----------------------+---------+---------------+---------+----------------+-------------+
|          ID          |  NAME   |    ZONE ID    | STATUS  |  EXTERNAL IP   | INTERNAL IP |
+----------------------+---------+---------------+---------+----------------+-------------+
| epde3ln8rhna2ea314vm | m       | ru-central1-b | RUNNING | 158.160.14.13  | 10.1.2.19   |
| epdl3d7n8qacj5d4m84u | w3      | ru-central1-b | RUNNING | 158.160.25.246 | 10.1.2.40   |
| epdmmk4revp6irnv3044 | w2      | ru-central1-b | RUNNING | 158.160.29.20  | 10.1.2.33   |
| epdt2nm0faq7i238lhc3 | w1      | ru-central1-b | RUNNING | 51.250.18.128  | 10.1.2.13   |
+----------------------+---------+---------------+---------+----------------+-------------+

kubeadm init \
  --apiserver-advertise-address=10.1.2.19 \
  --pod-network-cidr 10.244.0.0/16 \
  --apiserver-cert-extra-sans=158.160.14.13

kubeadm join 158.160.14.13:6443 --token 4yqqml.ci8vcf7rr67fa1jo \
    --discovery-token-ca-cert-hash sha256:9459b6bac40b0122051437c00fd5a8451259d912f418c1629fb65e8defdae02c 

yc-user@m:~$ kubectl get nodes
NAME   STATUS   ROLES           AGE     VERSION
m      Ready    control-plane   4d19h   v1.27.1
w1     Ready    <none>          4d18h   v1.27.1
w2     Ready    <none>          4d19h   v1.27.1
w3     Ready    <none>          4d19h   v1.27.1
```

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Документация Updating a Deployment](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment)
2. [Статья про стратегии обновлений](https://habr.com/ru/companies/flant/articles/471620/)

-----

### Задание 1. Выбрать стратегию обновления приложения и описать ваш выбор.

1. Имеется приложение, состоящее из нескольких реплик, которое требуется обновить.
2. Ресурсы, выделенные для приложения ограничены, и нет возможности их увеличить.
3. Запас по ресурсам в менее загруженный момент времени составляет 20%.
4. Обновление мажорное, новые версии приложения не умеют работать со старыми.
5. Какую стратегию обновления выберете и почему?

### Задание 2. Обновить приложение.

1. Создать deployment приложения с контейнерами nginx и multitool. Версию nginx взять 1.19. Кол-во реплик - 5.
2. Обновить версию nginx в приложении до версии 1.20, сократив время обновления до минимума. Приложение должно быть доступно.
3. Попытаться обновить nginx до версии 1.28, приложение должно оставаться доступным.
4. Откатиться после неудачного обновления.

## Дополнительные задания (со звездочкой*)

**Настоятельно рекомендуем выполнять все задания под звёздочкой.**   Их выполнение поможет глубже разобраться в материале.   
Задания под звёздочкой дополнительные (необязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию. 

### Задание 3*. Создать Canary deployment.

1. Создать 2 deployment'а приложения nginx.
2. При помощи разных ConfigMap сделать 2 версии приложения (веб-страницы).
3. С помощью ingress создать канареечный деплоймент, чтобы можно было часть трафика перебросить на разные версии приложения.

### Правила приема работы

1. Домашняя работа оформляется в своем Git репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд, а также скриншоты результатов
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md